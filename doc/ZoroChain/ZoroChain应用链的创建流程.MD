# ZoroChain应用链的创建流程
### 创建应用链的交易
* 由某一个节点发起一个创建应用链的交易，类似发布智能合约的方式，交易会执行创建应用链的系统调用
* 该系统调用的参数包括应用链的名称、Hash、网络端口号、种子节点地址、备选记账人地址等
* 由根链的共识节点对该交易进行验证，判断应用链Hash是否唯一
* 通过验证和共识后，将该交易出块保存在根链上，以便其他节点开始建立对应的P2P网络
* 把该交易保存出块的同时，在根链上额外保存该应用链的State数据，以便更快速的查找
* 其他节点在同步根链区块时会得到这个创建交易，并同样保存应用链的State数据

### 用于创建应用链的系统调用
* 类似于发布合约时调用的"Neo.Contract.Create"，创建应用链时需要调用"Zoro.AppChain.Create"
* 使用"sendrawtransaction"发起创建应用链的交易，在该交易里带上调用"Zoro.AppChain.Create"的脚本
* "Zoro.AppChain.Create"作为一个系统调用，其内部会创建一个State，用于记录应用链的相关信息

### 应用链的State
* LevelDB里用AppChainState记录应用链的状态数据
* AppChainState里记录了应用链的相关信息，包括名称、Hash、创建者、创建日期、网络端口号、种子节点地址、备选记账人地址

### 启动种子节点
* 在种子节点的配置文件里，把想要创建的应用链加入到关注列表里
* 依次启动种子节点，这些节点在同步根链的区块时会获知所有应用链的信息，其中包括正处于创建阶段的应用链
* 在验证了所关注的应用链存在后，这些种子节点会彼此连接，建立应用链的P2P网络

### 启动共识节点
* 在正式创建应用链之前，需要先准备好共识节点，目前规定最少四台
* 这些节点的账户地址必须是创建交易里指定的备选人
* 在节点的的配置文件里，关注新创建的应用链，并且标记为开启共识服务
* 依次启动这些共识节点，当有效的共识节点的数量超过通过决议所需的最小数量时，开始广播出块

### 生成创世块
* 应用链上出的第一个块是创世块
* 应用链的创世块只是用作标记该应用链生效，不包括货币的登记和分发交易 
* 其他节点同步到应用链的创世块后，认为该应用链已开始工作

### 应用链的管理合约
* 在ZoroChain的根链上有一个官方发布的应用链管理合约
* 该合约脚本提供更改备选记账人地址，更改种子节点等相关的功能
* 应用链管理合约的Hash地址记录在配置文件中，可以通过该地址调用管理合约
* 管理合约的脚本会通过修改State数据来保存应用链的各类信息

### 变更应用链的备选记账人
* 发起一个变更备选记账人的交易，通过查询应用链的状态，获得该应用链的管理合约地址，并在交易里执行该合约的脚本
* 拼装合约脚本的字节码时，指定调用更改备选记账人地址的方法，并在参数区里指定了新的备选记账人地址
* 该合约脚本会通过修改State数据来保存新的备选记账人地址
* 该交易上链后，节点同步到这个交易时，更新执行相同的合约脚本，更新应用链的备选记账人

### 变更应用链的端口号
* 考虑到变更端口号的复杂性，目前版本暂时不提供该功能