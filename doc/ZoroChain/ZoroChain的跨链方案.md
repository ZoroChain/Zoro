# 跨链实现
目前 NEO 和 Zoro 间的跨链通信(转账)通过智能合约存取资产和第三方管理程序转发交易来实现，因为 NEO 已经运行无法修改，只能依靠其现有机制来实现，但是这种方式全部依赖管理程序，安全性不够而且完全受中心化控制。

Zoro 目前还处在设计开发中，所以根链和应用链之间可以设计其他的跨链方案。

主要考虑因素：
* 保证跨链交易的原子性，要保证跨链双方都交易成功/失败；
* 一条链可以对另一条链的交易进行验证，B 链可以验证 A 链的一笔交易，验证通过后才可以在 B 链做相应的交易；
* 保证两条链的资产总量不变，A 转移一笔资产到 B 链，A 链资产减少，B 链对应资产增加；
* 两条链独立安全，一条链受到攻击时不影响与之通信的另一条链；


## 共识机制多签方案

### 实现思路：

* 应用链往根链跨链时，由应用链的共识机制往根链发一笔交易，这笔交易由应用链共识节点的多方签名，根链可以验证签名来确保消息可靠；
* 根链往应用链跨链时，根链会记录该交易，每个应用链的共识机制都监视根链，当发现根链有发往自己链的跨链交易时，应用链共识机制往本链发一笔交易。

应用链记录本链的资产 hash、锁仓地址、根链对应的映射资产 hash、锁仓地址(Bank 合约地址)。

### 应用链往根链

* 应用链用户往锁仓合约转一笔资产，标记这是一笔跨链转账；
* 应用链共识机制发现该笔跨链转账，根据转账的资产 hash 取得跨链所需参数；
* 共识机制验证该笔交易后，往根链发一笔共识节点多方签名的交易，实现跨链；
* 根链收到该交易，检查多签来判断交易是否有效。

多方签名：

* 应用链创建时创建一份多方签名，应用链的共识节点保留私钥，根链保留公钥；
* 定期更换多签密钥，或者更换共识节点时就更换。

交易参数：

* 跨链交易需要参数：原链交易 txid，原链 ChainHash，资产 AssetId，根链映射的资产 TargetAssetId，根链上锁仓合约地址 RootBankHash，转账地址 FromAddress，根链目标地址：ToAddress，转账金额 Value。

根链 Bank 权限控制：

* 应用链共识机制给根链发交易，从根链的锁仓合约(Bank)中取出资产给对应地址，取钱的接口权限需要限制；
* 可以考虑用根链共识节点的多签来验证，多签密钥更换时锁仓合约的验签地址也需要更换。

### 根链往应用链

* 根链用户往锁仓地址转一笔资产，标记这是一笔跨链转账；该交易确认时会记录它所在的区块索引；
* 应用链共识机制监测到该笔交易后，根据交易的资产 hash 查到应用链对应的资产和锁仓地址，同时取到跨链的目标地址、金额等信息；
* 共识机制根据以上信息往本链发一笔交易，从锁仓地址取钱给对应账户；该交易要记录根链交易所在的区块索引，后续如有需要校验跨链发起的操作需要先等待根链区块同步至对应高度；
* 从锁仓地址取钱的接口权限同样需要控制；
* 跨链交易完成后需要标记根链该消息已处理，防止双花。