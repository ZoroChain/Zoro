# NEO改成多链的思考
### 一、多链结构的管理
#### 根链和应用链
* 根链上记录创建应用链的交易数据
* 只提供创建应用链，不提供删除应用链
* 每一条链有一个唯一的名字字符串和对应的Hash来识别自身
#### 应用链的创建
* 用一种新的交易类型来处理和记录创建应用链的操作
* 该数据被保存在根链的数据库中
* 创建应用链时，要等根链完成该创建操作的共识后，才能正式启动新创建的应用链
#### 节点自由选择要运行哪些应用链
* 一个节点可以选择自己要运行哪些应用链
  * 为什么不做成每个节点都要运行所有的应用链？
* 每个节点只处理和转发自身运行的应用链数据

### 二、多链机构的数据存储问题
#### 根链中存储的数据类型
* 还是用Block和Transaction来存储数据
* 新增一条应用链
  * 用NEO的Transaction类派生出来？
* 和其他公链的数据交换

#### 每条链有各自独立的LevelDB
* NEO中有一个独立线程来处理LevelDB的数据存储
* Zoro中每条链的LevelDB是否都需要一个独立线程来处理数据存储？
* 或者是只有一个独立线程，或者一个线程池来处理Zoro中所有LevelDB的数据存储？

#### 多链结构的数据存储和初始化流程
* 应用链用各自的Hash值作为文件目录名，在各自独立的目录里保存LevelDB数据
* 先加载并解析根链的LevelDB
  * 需要遍历根链的所有块里的所有交易，以便获知当前已经创建了哪些应用链
  * 以后根链数据量大了会不会很慢？
* 从根链获知了应用链的信息后，开始加载应用链的LevelDB
  * 这里采用和NEO现有的LevelDBBlockChain相同的机制
  * 只加载区块头的索引，不加载区块和交易的详细数据

### 三、多链结构的网络通信的机制
* LocalNode代表本地节点
  * 负责和远程节点建立连接
* RemoteNode代表远程节点
  * 每次建立网络连接时会创建一个RemoteNode
  * 每个RemoteNode负责一个远程节点的消息收发
  * 使用异步函数机制

### 四、多链结构的数据同步
* NEO中，每次连接上一个远程节点后，会互发各自的区块高度，并以此来向对方请求自身没有同步过的区块头和区块数据
* Zoro中，建立连接后，先互发根链的区块高度，再互发各自运行的应用链的区块高度，之后再进行每个链的区块同步
* 在广播一个数据时，根据对方是否运行该数据所属的链来决定是否要发送
  * 另一种做法是广播时不做过滤，在收到数据时做过滤

### 五、多链结构的共识机制
* 根链的共识机制

* 应用链的共识机制

### 六、多链结构的工具程序修改
